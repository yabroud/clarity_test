<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <title>Stripe Checkout Sample</title>
    <meta name="description" content="A demo of Stripe Payment Intents" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

    <link rel="icon" href="favicon.ico" type="image/x-icon" />
    <link rel="stylesheet" href="css1/normalize.css" />
    <link rel="stylesheet" href="css1/global.css" />
    <!-- Load Stripe.js on your website. -->
    <script>

        $(document).ready(function () {

            $.ajax({
                url: "https://frenchless.herokuapp.com/checkout-test",
                beforeSend: function (xhr) {

                    let loading = `<img
                                    src="loading.gif"
                                    width="150"
                                    height="150"
                                    />`

                    $("#checkoutSection-list").html(loading)

                }
            }).done(function (response) {
      
                // $.get("https://frenchless.herokuapp.com/checkout-test", function (response) {

                    var checkoutSection = "<table class ='styled-table'><thead> <tr><th>Name</th> <th>Amount</th> <th>Currency</th> <th>Payment</th> <th>Country</th> </tr> </thead> <tbody>"

                    $.each(response.data, function (index, item) {

                        let payment = ''
                        if (item.description === 'Subscription creation') {
                            payment = 'Month'
                        } else {
                            payment = 'Once'
                        }

                        var censorWord = function (str) {
                            return str[0] + str[1] + "*".repeat(str.length - 2) +str[str.length - 1] ;
                        }
                        var censorEmail = function (email) {
                            var arr = email.split("@");
                            return censorWord(arr[0]) + "@" + arr[1];
                        }



                        checkoutSection += `<tr><td> ${censorEmail(item.billing_details.email)}</td> <td>${item.amount / 100}</td> <td>${item.currency}</td><td>${payment}</td><td>${item.billing_details.address.country}</td> </tr>`;
                    })
                    checkoutSection += `</tbody> </table>`

                    $("#checkoutSection-list").html(checkoutSection)

                // })
            });







        })

    </script>
</head>

<body>
    <div class="togethere-background"></div>



    <div class="sr-root">
        <div class="sr-main">
            <header class="sr-header">
                <div class="sr-header__logo"></div>

            </header>
            <h1>Payments List</h1>

            
            <br>
            <br>
            <br>
            <br>
            <br>
            <div id="checkoutSection-list"></div>

        </div>
    </div>





</body>

</html>