<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <title>Stripe Checkout Sample</title>
  <meta name="description" content="A demo of Stripe client-only Checkout" />
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

  <link rel="icon" href="favicon.ico" type="image/x-icon" />
  <link rel="stylesheet" href="css1/normalize.css" />
  <link rel="stylesheet" href="css1/global.css" />
  <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/v/dt/dt-1.10.25/datatables.min.css"/>
 
<script type="text/javascript" src="https://cdn.datatables.net/1.10.25/js/jquery.dataTables.min.js"></script>
<link rel="stylesheet" href="https://cdn.datatables.net/1.10.25/css/jquery.dataTables.min.css" />

  <script src="https://js.stripe.com/v3/"></script>
  <script>
    $(document).ready(function () {

      $.ajax({
                url: "https://frenchless.herokuapp.com/checkout",
                beforeSend: function (xhr) {

                    let loading = `<img
                                    src="loading.gif"
                                    width="150"
                                    height="150"
                                    />`

                    $("#checkoutSection-list").html(loading)

                }
            }).done(function (response) {
      
                // $.get("https://frenchless.herokuapp.com/checkout", function (response) {

                    var checkoutSection = "<table class ='styled-table'><thead> <tr><th>Name</th> <th>Amount</th> <th>Currency</th> <th>Payment</th> <th>Country</th> </tr> </thead> <tbody>"

                    $.each(response.data, function (index, item) {

                        let payment = ''
                        if (item.description === 'Subscription creation') {
                            payment = 'Month'
                        } else {
                            payment = 'Once'
                        }

                        var censorWord = function (str) {
                            return str[0] + str[1] + "*".repeat(str.length - 2) +str[str.length - 1] + str[str.length - 2] ;
                        }
                        var censorEmail = function (email) {
                            var arr = email.split("@");
                            return censorWord(arr[0]) + "@" + arr[1];
                        }



                        checkoutSection += `<tr><td> ${censorEmail(item.billing_details.email)}</td> <td>${item.amount / 100}</td> <td>${item.currency}</td><td>${payment}</td><td>${item.billing_details.address.country}</td> </tr>`;
                    })
                    checkoutSection += `</tbody> </table>`

                    $("#checkoutSection-list").html(checkoutSection)

                // })
            });





    })
  </script>
</head>

<body>
  <div class="togethere-background"></div>
  <div class="sr-root">
    <div class="sr-main">
      <header class="sr-header">
        <a href="./">
          <div class="sr-header__logo"></div>
        </a> 
      </header>
      <div class="sr-payment-summary completed-view">
        <h1>Your test payment succeeded</h1>
        <h4>Checkout Session ID: <span id="session"></span></h4>
      </div>

      <h1 style="text-align: center;">Payments List</h1>

          <div style="text-align: center;" id="checkoutSection-list"></div>
    </div>
    <script>
      var urlParams = new URLSearchParams(window.location.search);

      if (urlParams.has("session_id")) {
        document.getElementById("session").textContent = urlParams.get(
          "session_id"
        );
      }


 
    </script>
</body>

</html>